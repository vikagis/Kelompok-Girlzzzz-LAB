<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary p-0 m-0">
      <div class="container-fluid pt-2 pb-2" style="background-color: #ffd6d6">
        <img
          src="gambar/money.png"
          alt="Money Tracker Image"
          style="max-width: 5%"
          class="me-4"
        />
        <button
          class="navbar-toggler ms-auto"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav justify-content-between" style="width: 95%">
            <li class="nav-item" id="helloUser">
              <a class="nav-link" href="#">Hello, </a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="main.html">Main</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="income.html">Income</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="outcome.html">Outcome</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="about.html">About us</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container mt-5">
      <div id="saldoBox" class="saldo-box">
        <h2 id="saldo">Balance</h2>
      </div>
      <div id="transactionBox" class="transaction-box">
        <h2>Transaction</h2>
        <ul id="transactionList"></ul>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script>
      // Fungsi untuk memformat angka menjadi format mata uang Rupiah
      function formatRupiah(angka) {
        var reverse = angka.toString().split("").reverse().join(""),
          ribuan = reverse.match(/\d{1,3}/g);
        ribuan = ribuan.join(".").split("").reverse().join("");
        return "Rp" + ribuan;
      }

      // Ambil nama pengguna dari local storage
      const username = localStorage.getItem("username");

      // Periksa apakah nama pengguna ada
      if (username) {
        // Jika ada, tambahkan ke teks pada elemen navbar
        document.getElementById("helloUser").innerHTML =
          '<a class="nav-link" href="#">Hello, ' + username + "!</a>";
      }

      // Ambil saldo dari localStorage
      let saldo = localStorage.getItem("saldo");
      saldo = saldo ? parseFloat(saldo) : 0;

      // Tampilkan saldo dengan format Rupiah
      document.getElementById("saldo").textContent =
        "Saldo Sekarang: " + formatRupiah(saldo);
      // Data transaksi - diasumsikan diambil dari penyimpanan lokal
      let transactions = localStorage.getItem("transactions");
      transactions = transactions ? JSON.parse(transactions) : [];

      // Hitung saldo
      transactions.forEach((transaction) => {
        if (transaction.type === "income") {
          saldo += transaction.amount;
        } else if (transaction.type === "outcome") {
          saldo -= transaction.amount;
        }
      });

      // Tampilkan saldo dengan format Rupiah
      document.getElementById("saldo").textContent =
        "Saldo Sekarang: " + formatRupiah(saldo);
      updateBalanceAndTransactions();

      // Fungsi untuk memperbarui saldo dan daftar transaksi
      function updateBalanceAndTransactions() {
        let saldo = 0;
        let transactions = localStorage.getItem("transactions");
        transactions = transactions ? JSON.parse(transactions) : [];

        // Hitung saldo dan perbarui daftar transaksi
        const transactionList = document.getElementById("transactionList");
        transactionList.innerHTML = ""; // Kosongkan daftar transaksi sebelum memperbarui
        transactions.forEach((transaction) => {
          console.log("transaction", transaction);
          const listItem = document.createElement("li");
          if (transaction.type === "income") {
            saldo += transaction.amount;
            listItem.textContent =
              "Pemasukan: " + formatRupiah(transaction.amount.toFixed(2));
            listItem.style.color = "green";
          } else if (transaction.type === "outcome") {
            saldo -= transaction.amount;
            listItem.textContent =
              "Pengeluaran: " + formatRupiah(transaction.amount.toFixed(2));
            listItem.style.color = "red";
          }
          transactionList.appendChild(listItem);
        });

        // Perbarui saldo
        document.getElementById("saldo").textContent =
          "Saldo Sekarang: " + formatRupiah(saldo.toFixed(2));
      }

      function handleFormSubmit(type) {
        const transactionName = document
          .getElementById("transactionname")
          .value.trim();
        const transactionNominal = parseFloat(
          document.getElementById("transactionnominal").value.trim()
        );
        const transactionType =
          document.getElementById("transactiontype").value;
        // Buat elemen li untuk menampilkan informasi transaksi
        const listItem = document.createElement("li");
        // Tetapkan teks dan warna berdasarkan jenis transaksi
        if (transaction.type === "income") {
          listItem.textContent =
            "Pemasukan: " +
            transaction.name +
            " - " +
            formatRupiah(transaction.amount.toFixed(2));
          listItem.style.color = "green";
        } else if (transaction.type === "outcome") {
          listItem.textContent =
            "Pengeluaran: " +
            transaction.name +
            " - " +
            formatRupiah(transaction.amount.toFixed(2));
          listItem.style.color = "red";
        }
        // Tambahkan elemen li ke dalam kotak transaksi
        document.getElementById("transactionList").appendChild(listItem);

        if (
          transactionName === "" ||
          isNaN(transactionNominal) ||
          transactionType === ""
        ) {
          alert("Transaksi belum selesai, silakan lengkapi formulir!");
        } else {
          const transaction = {
            name: transactionName,
            amount: transactionNominal,
            type: type, // menggunakan parameter type untuk menentukan jenis transaksi
          };

          let transactions = localStorage.getItem("transactions");
          transactions = transactions ? JSON.parse(transactions) : [];
          transactions.push(transaction);
          localStorage.setItem("transactions", JSON.stringify(transactions));

          // Panggil fungsi untuk memperbarui saldo dan daftar transaksi setelah transaksi ditambahkan
          updateBalanceAndTransactions();

          alert("Transaksi sukses!");
          window.location.href = "main.html";
        }
      }
    </script>
  </body>
</html>
